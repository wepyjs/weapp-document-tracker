<div class="book with-summary">

<div class="head">

<div class="head_box">

# [](javascript:; "_('微信公众平台 小程序')")

<div class="header_ctrls">

*   [介绍](javascript:;)
    *   [小程序介绍](https://developers.weixin.qq.com/miniprogram/introduction/index.html?t=18110616)
    *   [小游戏介绍](https://developers.weixin.qq.com/minigame/introduction/index.html?t=18110616)
*   [设计](https://developers.weixin.qq.com/miniprogram/design/index.html?t=18110616)
*   [小程序开发](javascript:;)
    *   [小程序开发](https://developers.weixin.qq.com/miniprogram/dev/index.html?t=18110616)
    *   [小游戏开发](https://developers.weixin.qq.com/minigame/dev/index.html?t=18110616)
*   [运营](https://developers.weixin.qq.com/miniprogram/product/index.html?t=18110616)
*   [数据](javascript:;)
    *   [小程序数据](https://developers.weixin.qq.com/miniprogram/analysis/index.html?t=18110616)
    *   [小游戏数据](https://developers.weixin.qq.com/minigame/analysis/index.html?t=18110616)
*   [社区](https://developers.weixin.qq.com/)

*   [中文](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/development.html?t=18110616)<span class="split-line">/</span>
*   [EN](https://developers.weixin.qq.com/miniprogram/en/dev/framework/plugin/development.html?t=18110616)

</div>

</div>

</div>

<div class="sub_nav_box">

<div class="sub_nav_inner">

<div class="book-summary-opr" id="js-book-summary-opr"><a class="book-summary-btn"></a></div>

<div class="top_sub_nav">

<div class="top_title_wap"><span class="icon_title icon_dev"></span>

微信小程序开发文档

</div>

*   [简易教程](../../)
*   [框架](../MINA.html)
*   [组件](../../component/)
*   [API](../../api/)
*   [工具](../../devtools/devtools.html)
*   [小程序·云开发](../../wxcloud/basis/getting-started.html)

</div>

<div id="book-search-input" role="search">

<form><label for="search-input" class="search-icon" id="js-search-icon"></label><input type="text" id="search-input" name="search-input" placeholder="搜索"> </form>

</div>

*   [中文](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/development.html?t=18110616)<span class="split-line">/</span>
*   [EN](https://developers.weixin.qq.com/miniprogram/en/dev/framework/plugin/development.html?t=18110616)

</div>

</div>

<div class="book-summary">

<div class="book-summary-home" id="js-summary-home"><a><span class="icon_home_s icon_dev"></span><span class="s_title_2">开发文档首页</span></a></div>

<nav role="navigation">

*   [目录结构](../structure.html)
*   [配置](../config.html)
    *   [全局配置](../config.html#全局配置)
    *   [页面配置](../config.html#页面配置)
*   [逻辑层](../app-service/)
    *   [注册程序](../app-service/app.html)
    *   [场景值](../app-service/scene.html)
    *   [注册页面](../app-service/page.html)
        *   [初始数据](../app-service/page.html#data)
        *   [生命周期回调函数](../app-service/page.html#生命周期回调函数)
        *   [页面事件处理函数](../app-service/page.html#页面事件处理函数)
        *   [组件事件处理函数](../app-service/page.html#组件事件处理函数)
        *   [route](../app-service/page.html#pageroute)
        *   [setData](../app-service/page.html#pageprototypesetdataobject-data-function-callback)
        *   [页面生命周期](../app-service/page.html#生命周期)
    *   [路由](../app-service/route.html)
    *   [模块化](../app-service/module.html)
    *   [API](../app-service/api.html)
*   [视图层](../view/)
    *   [WXML](../view/wxml/)
        *   [数据绑定](../view/wxml/data.html)
        *   [列表渲染](../view/wxml/list.html)
        *   [条件渲染](../view/wxml/conditional.html)
        *   [模板](../view/wxml/template.html)
        *   [事件](../view/wxml/event.html)
        *   [引用](../view/wxml/import.html)
    *   [WXSS](../view/wxss.html)
    *   [基础组件](../view/component.html)
    *   [WXS](../view/wxs/)
        *   [模块](../view/wxs/01wxs-module.html)
        *   [变量](../view/wxs/02variate.html)
        *   [注释](../view/wxs/03annotation.html)
        *   [运算符](../view/wxs/04operator.html)
        *   [语句](../view/wxs/05statement.html)
        *   [数据类型](../view/wxs/06datatype.html)
        *   [基础类库](../view/wxs/07basiclibrary.html)
    *   [获取界面上的节点信息](../view/selector.html)
    *   [响应显示区域变化](../view/resizable.html)
*   [自定义组件](../custom-component/)
    *   [组件模板和样式](../custom-component/wxml-wxss.html)
    *   [Component构造器](../custom-component/component.html)
    *   [组件事件](../custom-component/events.html)
    *   [behaviors](../custom-component/behaviors.html)
    *   [组件间关系](../custom-component/relations.html)
    *   [抽象节点](../custom-component/generics.html)
    *   [自定义组件扩展](../custom-component/extend.html)
    *   [开发第三方自定义组件](../custom-component/trdparty.html)
*   [插件](.)
    *   [开发插件](./development.html)
    *   [使用插件](./using.html)
    *   [插件调用 API 的限制](./api-limit.html)
    *   [插件使用组件的限制](./component-limit.html)
    *   [插件功能页](./functional-pages.html)
        *   [用户信息功能页](./functional-pages/user-info.html)
        *   [支付功能页](./functional-pages/request-payment.html)
        *   [收货地址功能页](./functional-pages/choose-address.html)
*   [基础能力](../ability/network.html)
    *   [网络](../ability/network.html)
        *   [使用说明](../ability/network.html)
        *   [局域网通信](../ability/mDNS.html)
    *   [存储](../ability/storage.html)
    *   [文件系统](../ability/file-system.html)
    *   [画布](../ability/canvas.html)
    *   [分包加载](../subpackages.html)
        *   [使用分包](../subpackages/basic.html)
        *   [独立分包](../subpackages/independent.html)
        *   [分包预下载](../subpackages/preload.html)
    *   [多线程 Worker](../workers.html)
*   [硬件能力](../device/bluetooth.html)
    *   [蓝牙](../device/bluetooth.html)
    *   [NFC](../device/nfc.html)
    *   [Wi-Fi](../device/wifi.html)
*   [开放能力](../open-ability/login.html)
    *   [用户信息](../open-ability/login.html)
        *   [小程序登录](../open-ability/login.html)
        *   [UnionID 机制说明](../open-ability/union-id.html)
        *   [授权](../open-ability/authorize.html)
        *   [开放数据校验与解密](../open-ability/signature.html)
        *   [获取手机号](../open-ability/getPhoneNumber.html)
        *   [生物认证](../open-ability/bio-auth.html)
    *   [转发](../open-ability/share.html)
        *   [转发](../open-ability/share.html)
        *   [动态消息](../open-ability/share/updatable-message.html)
    *   [打开App](../open-ability/launchApp.html)
    *   [消息](../open-ability/template-message.html)
        *   [模板消息](../open-ability/template-message.html)
        *   [统一服务消息](../open-ability/uniform-message.html)
        *   [客服消息](../open-ability/customer-message/customer-message.html)
            *   [概述](../open-ability/customer-message/customer-message.html)
            *   [接收消息和事件](../open-ability/customer-message/receive.html)
            *   [发送消息](../open-ability/customer-message/send.html)
            *   [转发消息](../open-ability/customer-message/trans.html)
            *   [下发客服输入状态](../open-ability/customer-message/typing.html)
            *   [临时素材](../open-ability/customer-message/temp-media.html)
    *   [卡券](../open-ability/card/card.html)
        *   [概述](../open-ability/card/card.html)
        *   [会员卡组件](../open-ability/card/membership-card.html)
    *   [获取二维码](../open-ability/qr-code.html)
    *   [数据分析](../open-ability/data-analysis.html)
    *   [附近的小程序](../open-ability/nearby.html)
*   [可用性](../usability/debug.html)
    *   [调试](../usability/debug.html)
    *   [运行环境](../details.html)
        *   [平台差异](../details.html#平台差异)
        *   [ES6 支持情况](../details.html#客户端-es6-api-支持情况)
    *   [运行机制](../operating-mechanism.html)
    *   [性能](../performance/)
        *   [优化建议](../performance/tips.html)
        *   [分析工具](../performance/tools.html)
*   [基础库](../client-lib/)
    *   [版本分布](../client-lib/version.html)
    *   [与客户端版本对应关系](../client-lib/client.html)
    *   [旧版本兼容](../compatibility.html)
    *   [更新日志](../release.html)
        *   [v2.x版本](../release/v2.html)
        *   [v1.x版本](../release/v1.html)
        *   [v0.x版本](../release/v0.html)

</nav>

</div>

<div class="book-body">

<div class="body-inner">

<div class="page-wrapper" tabindex="-1" role="main">

<div class="page-inner">

<div id="book-search-results">

<div class="search-noresults">

<section class="normal markdown-section">

# 开发插件

开发插件前，请阅读了解[《小程序插件接入指南》](https://developers.weixin.qq.com/miniprogram/introduction/plugin.html?t=18110616)了解开通流程及开放范围，并开通插件功能。如果未开通插件功能，将无法上传插件。

## 创建插件项目

插件类型的项目可以在开发者工具中直接创建。[详情](../../devtools/plugin.html)

![创建插件](https://developers.weixin.qq.com/miniprogram/dev/devtools/image/devtools2/createplugin.png?t=18110616)

新建插件类型的项目后，如果创建示例项目，则项目中将包含三个目录：

*   `plugin` 目录：插件代码目录。
*   `miniprogram` 目录：放置一个小程序，用于调试插件。
*   `doc` 目录：用于放置插件开发文档。

`miniprogram` 目录内容可以当成普通小程序来编写，用于插件调试、预览和审核。下面的内容主要介绍 `plugin` 中的插件代码及 `doc` 中的插件开发文档。

我们提供了[一个可以直接在微信开发者工具中查看的完整插件示例](wechatide://minicode/NrPCBmmT7B1B)，开发者可以和本文互相对照以便理解。请注意：

1.  由于插件需要 appid 才能工作，请填入一个 appid；
2.  由于当前代码片段的限制，打开该示例后请 **手动将 appid 填写到 `miniprogram/app.json` 中（如下图）使示例正常运行。**

![手动填写 appid](https://developers.weixin.qq.com/miniprogram/dev/image/plugin_minicode_guide.png?t=18110616)

## 插件目录结构

一个插件可以包含若干个自定义组件、页面，和一组 js 接口。插件的目录内容如下：

    plugin
    ├── components
    │   ├── hello-component.js   // 插件提供的自定义组件（可以有多个）
    │   ├── hello-component.json
    │   ├── hello-component.wxml
    │   └── hello-component.wxss
    ├── pages
    │   ├── hello-page.js        // 插件提供的页面（可以有多个，自小程序基础库版本 2.1.0 开始支持）
    │   ├── hello-page.json
    │   ├── hello-page.wxml
    │   └── hello-page.wxss
    ├── index.js                 // 插件的 js 接口
    └── plugin.json              // 插件配置文件

## 插件配置文件

向第三方小程序开放的所有自定义组件、页面和 js 接口都必须在插件配置文件 `plugin.json` 列出，格式如下：

**代码示例：**

    {
      "publicComponents": {
        "hello-component": "components/hello-component"
      },
      "pages": {
        "hello-page": "pages/hello-page"
      },
      "main": "index.js"
    }

这个配置文件将向第三方小程序开放一个自定义组件 `hello-component`，一个页面 `hello-page` 和 `index.js` 下导出的所有 js 接口。

## 进行插件开发

请注意：在插件开发中，只有[部分接口](api-limit.html)可以直接调用；另外还有部分能力（如 获取用户信息 和 发起支付 等）可以通过[插件功能页](functional-pages.html)的方式使用。

### 自定义组件

插件可以定义若干个自定义组件，这些自定义组件都可以在插件内相互引用。但提供给第三方小程序使用的自定义组件必须在配置文件中列出（参考上文）。

除去接口限制以外，自定义组件的编写和组织方式与一般的自定义组件相同，每个自定义组件由 `wxml`, `wxss`, `js` 和 `json` 四个文件组成。具体可以参考[自定义组件的文档](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/?t=18110616)。

### 页面

插件从小程序基础库版本 [2.1.0](../compatibility.html "基础库 2.1.0 开始支持，低版本需做兼容处理。") 开始支持页面。插件可以定义若干个插件页面，可以从本插件的自定义组件、其他页面中跳转，或从第三方小程序中跳转。其中，提供给第三方小程序跳转的页面必须在配置文件中列出（参考上文）。

除去接口限制以外，插件的页面编写和组织方式与一般的页面相同，每个页面由 `wxml`, `wxss`, `js` 和 `json` 四个文件组成。具体可以参考其他关于页面的文档。

插件执行页面跳转的时候，可以使用 `navigator` 组件。当插件跳转到自身页面时， `url` 应设置为这样的形式：`plugin-private://PLUGIN_APPID/PATH/TO/PAGE` 。需要跳转到其他插件时，也可以这样设置 `url` 。

**代码示例：**

    <navigator url="plugin-private://wxidxxxxxxxxxxxxxx/pages/hello-page">    
      Go to pages/hello-page!
    </navigator>

自基础库版本 [2.2.2](../compatibility.html "基础库 2.2.2 开始支持，低版本需做兼容处理。") 开始，在插件自身的页面中，插件还可以调用 `wx.navigateTo` 来进行页面跳转， `url` 格式与使用 `navigator` 组件时相仿。

### 接口

插件可以在接口文件（在配置文件中指定，详情见上文）中 export 一些 js 接口，供插件的使用者调用，如：

**代码示例：**

    module.exports = {
      hello: function() {
        console.log('Hello plugin!')
      }
    }

## 预览、上传和发布

插件可以像小程序一样预览和上传，但插件没有体验版。

插件会同时有多个线上版本，由使用插件的小程序决定具体使用的版本号。

手机预览和提审插件时，会使用一个特殊的小程序来套用项目中 `miniprogram` 文件夹下的小程序，从而预览插件。

*   （建议的方式）如果当前开发者有[测试号](../../devtools/sandbox.html)，则会使用这个测试号；在测试号的设置页中可以看到测试号的 `appid` 、 `appsecret` 并设置域名列表。
*   否则，将使用“插件开发助手”，它具有一个特定的 `appid` 。

## 插件开发文档

在第三方小程序使用插件时，插件代码并不可见。因此，除了插件代码，我们还支持插件开发者上传一份插件开发文档。这份开发文档将展示在插件详情页，供其他开发者在浏览插件和使用插件时进行阅读和参考。插件开发者应在插件开发文档中对插件提供的自定义组件、页面、接口等进行必要的描述和解释，方便第三方小程序正确使用插件。

插件开发文档必须放置在插件项目根目录中的 `doc` 目录下，目录结构如下：

    doc
    ├── README.md   // 插件文档，应为 markdown 格式
    └── picture.jpg // 其他资源文件，仅支持图片

其中，`README.md` 的编写有一定的 **限制条件**，具体来说：

1.  引用到的图片资源不能是网络图片，且必须放在这个目录下；
2.  文档中的链接只能链接到：
    *   微信开发者社区（developers.weixin.qq.com）
    *   微信公众平台（mp.weixin.qq.com）
    *   GitHub（github.com）

编辑 `README.md` 之后，可以使用开发者工具打开 `README.md`，并在编辑器的右下角预览插件文档和单独上传插件文档。发布上传文档后，文档不会立刻发布。此时可以使用帐号和密码登录 [管理后台](https://mp.weixin.qq.com) ，在 小程序插件 > 基本设置 中预览、发布插件文档。

## 其他注意事项

### 插件请求签名

插件在使用 `wx.request` 等 API 发送网络请求时，将会额外携带一个签名 `HostSign` ，用于验证请求来源于小程序插件。这个签名位于请求头中，形如：

    X-WECHAT-HOSTSIGN: {"noncestr":"NONCESTR", "timestamp":"TIMESTAMP", "signature":"SIGNATURE"}

其中， `NONCESTR` 是一个随机字符串， `TIMESTAMP` 是生成这个随机字符串和 `SIGNATURE` 的 UNIX 时间戳。它们是用于计算签名 `SIGNATRUE` 的参数，签名算法为：

    SIGNATURE = sha1([APPID, NONCESTR, TIMESTAMP, TOKEN].sort().join(''))

其中，`APPID` 是 **所在小程序** 的 AppId （可以从请求头的 `referrer` 中获得）；`TOKEN` 是插件 Token，可以在小程序插件基本设置中找到。

插件开发者可以在服务器上按以下步骤校验签名：

1.  `sort` 对 `APPID` `NONCESTR` `TIMESTAMP` `TOKEN` 四个值表示成字符串形式，按照字典序排序（同 JavaScript 数组的 sort 方法）；
2.  `join` 将排好序的四个字符串直接连接在一起；
3.  对连接结果使用 `sha1` 算法，其结果即 `SIGNATURE` 。

自基础库版本 [2.0.7](../compatibility.html "基础库 2.0.7 开始支持，低版本需做兼容处理。") 开始，在小程序运行期间，若网络状况正常， `NONCESTR` 和 `TIMESTAMP` 会每 10 分钟变更一次。如有必要，可以通过判断 `TIMESTAMP` 来确定当前签名是否依旧有效。

</section>

</div>

<div class="search-results">

<div class="has-results">

# <span class="search-results-count"></span>个结果 "<span class="search-query"></span>"

</div>

<div class="no-results">

# 没有找到相关内容 "<span class="search-query"></span>"

</div>

</div>

</div>

</div>

</div>

<div class="foot" id="footer">

*   [关于腾讯](https://www.tencent.com/)
*   [文档中心](https://developers.weixin.qq.com/miniprogram/introduction/index.html)
*   [辟谣中心](https://mp.weixin.qq.com/cgi-bin/opshowpage?action=dispelinfo)
*   [客服中心](https://kf.qq.com/product/wx_xcx.html)
*   [联系邮箱](mailto:weixinmp@qq.com)
*   Copyright © 2012-<span id="s_copyright_year"></span> Tencent. All Rights Reserved.

</div>

</div>

[](./using.html)</div>

</div>